@{
    Hatfield.WebMap.Domain.WebMappingSite site = ViewBag.site;

    int tokenValidFor_seconds = -1;
    if (Session["ArcGISTokenExpiry" + Hatfield.WebMap.Domain.TokenMode.ClientToServer.ToString()] != null)
    {
        DateTime tokenExpiry = Convert.ToDateTime(Session["ArcGISTokenExpiry"]);
        if (tokenExpiry.Ticks > DateTime.UtcNow.Ticks)
        { 
            var ts = new TimeSpan(tokenExpiry.Ticks - DateTime.UtcNow.Ticks);
            tokenValidFor_seconds = Convert.ToInt32(Math.Round(ts.TotalSeconds))-120;
        }
    }
    if (site.HasLayerOfType<Hatfield.WebMap.Domain.Layers.WMSLayer>())
    {
        if (tokenValidFor_seconds < Hatfield.WebMap.Repositories.GeoServerAuthKeyRepository.DEFAULT_IDLE_SECONDS)
        {
            tokenValidFor_seconds = Hatfield.WebMap.Repositories.GeoServerAuthKeyRepository.DEFAULT_IDLE_SECONDS;
        }
    }
}
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>@ViewBag.Title</title>

@if (tokenValidFor_seconds > 0)
{
    @* refresh the page when the token becomes invalid *@
    <meta http-equiv="refresh" content="@tokenValidFor_seconds">
}
@* //Idea: monitor and display the download of all these javascript files: http://stackoverflow.com/a/11265984/691965  *@
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
@*<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">*@
<!-- Load Leaflet from CDN-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.2/leaflet.css" />


@if (site.hasMapControl(Hatfield.WebMap.Domain.WebMapControl.IdentifySidebar))
{
    <!-- Leaflet hatIdentifySidebar -->
    <link href="@Url.Content("~/js/leaflet.hatIdentifySidebar/L.Control.hatIdentifySidebar.css")?v=20170613" rel='stylesheet' />
}
@if (site.hasMapControl(Hatfield.WebMap.Domain.WebMapControl.FullScreen))
{
<!-- Leaflet Fullscreen -->
<link href="@Url.Content("~/js/leaflet.hatFullScreen/leaflet.hatfullscreen.css")?v=20170613" rel='stylesheet' />
}
@if (site.hasMapControl(Hatfield.WebMap.Domain.WebMapControl.MouseCoordinates))
{ 
<!-- Leaflet mouseCoordinate -->
<link href='@Url.Content("~/js/leaflet.mouseCoordinate/leaflet.mouseCoordinate.css")' rel='stylesheet' />
}
@if (site.hasMapControl(Hatfield.WebMap.Domain.WebMapControl.Measure))
{
<!-- Leaflet.Measure -->
<link href='@Url.Content("~/js/leaflet-measure-2.1.7/leaflet-measure.css")' rel='stylesheet' />
}

    
@if (site.hasMapControl(Hatfield.WebMap.Domain.WebMapControl.TableOfContents))
{
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/js/jquery-aciTree-4.5.0-rc.10/css/aciTree.css")" media="all">
}
@if (site.hasMapControl(Hatfield.WebMap.Domain.WebMapControl.Redliner))
{
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/js/leaflet.redliner/styles/redliner.css")" media="all">
}

@if (site.hasMapControl(Hatfield.WebMap.Domain.WebMapControl.hatPanel))
{
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/js/leaflet.hatPanel/L.hatPanel.css")" media="all">
}

<!-- link the css for modified leaflet sidebar -->
@*
    <link rel="stylesheet" type="text/css" href="http://hf-nv-build01/CDN/leaflet/leaflet-sidebar/leaflet-sidebar.css" media="all">
*@
@if (site.hasMapControl(Hatfield.WebMap.Domain.WebMapControl.BienHoaSidebar))
{
<link rel="stylesheet" type="text/css" href="@Url.Content("~/js/leaflet.hatBienHoaSidebar/L.Control.hatBienHoaSidebar.css")" media="all">
}
<link rel="stylesheet" href="@Url.Content("~/css/AllSites.css?v=20150721")">
@if (site.HasSiteSpecificCssFileName && !string.IsNullOrWhiteSpace(site.SiteSpecificCssFileName))
{
    <link rel="stylesheet" href="@Url.Content("~/css/sites/" + site.SiteSpecificCssFileName + "?v=20170519")">
}

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


