L.Control.mouseCoordinate=L.Control.extend({options:{gps:true,utm:false,utmref:false,position:"bottomright",_sm_a:6378137,_sm_b:6356752.314,_sm_EccSquared:0.00669437999013,_UTMScaleFactor:0.9996},onAdd:function(e){this._map=e;var b="leaflet-control-mouseCoordinate";var d=this._container=L.DomUtil.create("div",b);var h=this.options;this._gpsPositionContainer=L.DomUtil.create("div","gpsPos",d);e.on("mousemove",this._update,this);return d},_update:function(d){var l=Math.round(d.latlng.lat*100000)/100000;var m=Math.round(d.latlng.lng*100000)/100000;var h={lat:l,lng:m};var b="<table>";if(this.options.gps){b+="<tr><td>GPS</td><td>"+l+"</td><td> "+m+"</td></tr>";var j=this._geo2geodeziminuten(h);b+="<tr><td></td><td style='width: 75px'>"+j.NS+" "+j.latgrad+"&deg; "+j.latminuten+"</td><td style='width: 75px'> "+j.WE+" "+j.lnggrad+"&deg; "+j.latminuten+"</td></tr>";var k=this._geo2gradminutensekunden(h);b+="<tr><td></td><td>"+k.NS+" "+k.latgrad+"&deg; "+k.latminuten+"&prime; "+k.latsekunden+"&Prime;</td><td> "+k.WE+" "+k.lnggrad+"&deg; "+k.latminuten+"&prime; "+k.lngsekunden+"&Prime;</td></tr>"}if(this.options.utm){var n=this._geo2utm(h);b+="<tr><td>UTM</td><td colspan='2'>"+n.zone+"&nbsp;"+n.x+"&nbsp;"+n.y+"</td></tr>"}if(this.options.utmref){var o=this._utm2mgr(this._geo2utm(h));b+="<tr><td>UTM REF</td><td colspan='2'>"+o.zone+"&nbsp;"+o.band+"&nbsp;"+o.x+"&nbsp;"+o.y+"</td></tr>"}b+="</table>";this._gpsPositionContainer.innerHTML=b},_utm2geo:function utm2geo(b){zone=b.zone;ew=b.x;nw=b.y;if(zone===""||ew===""||nw===""){zone="";ew="";nw="";return}band=zone.substr(2,1);zone=parseFloat(zone);ew=parseFloat(ew);nw=parseFloat(nw);a=6378137;f=0.00335281068;pi=Math.PI;c=a/(1-f);ex2=(2*f-f*f)/((1-f)*(1-f));ex4=ex2*ex2;ex6=ex4*ex2;ex8=ex4*ex4;e0=c*(pi/180)*(1-3*ex2/4+45*ex4/64-175*ex6/256+11025*ex8/16384);f2=(180/pi)*(3*ex2/8-3*ex4/16+213*ex6/2048-255*ex8/4096);f4=(180/pi)*(21*ex4/256-21*ex6/256+533*ex8/8192);f6=(180/pi)*(151*ex6/6144-453*ex8/12288);if(band>="N"||band===""){m_nw=nw}else{m_nw=nw-10000000}sigma=(m_nw/0.9996)/e0;sigmr=sigma*pi/180;bf=sigma+f2*Math.sin(2*sigmr)+f4*Math.sin(4*sigmr)+f6*Math.sin(6*sigmr);br=bf*pi/180;tan1=Math.tan(br);tan2=tan1*tan1;tan4=tan2*tan2;cos1=Math.cos(br);cos2=cos1*cos1;etasq=ex2*cos2;nd=c/Math.sqrt(1+etasq);nd2=nd*nd;nd4=nd2*nd2;nd6=nd4*nd2;nd3=nd2*nd;nd5=nd4*nd;lh=(zone-30)*6-3;dy=(ew-500000)/0.9996;dy2=dy*dy;dy4=dy2*dy2;dy3=dy2*dy;dy5=dy3*dy2;dy6=dy3*dy3;b2=-tan1*(1+etasq)/(2*nd2);b4=tan1*(5+3*tan2+6*etasq*(1-tan2))/(24*nd4);b6=-tan1*(61+90*tan2+45*tan4)/(720*nd6);l1=1/(nd*cos1);l3=-(1+2*tan2+etasq)/(6*nd3*cos1);l5=(5+28*tan2+24*tan4)/(120*nd5*cos1);bw=bf+(180/pi)*(b2*dy2+b4*dy4+b6*dy6);lw=lh+(180/pi)*(l1*dy+l3*dy3+l5*dy5);return{lat:bw,lng:lw}},_geo2utm:function(b){lw=b.lng;bw=b.lat;if(lw<=-180||lw>180||bw<=-80||bw>=84){alert("Werte nicht im Bereich des UTM Systems\n-180Â° <= LW < +180Â°, -80Â° < BW < 84Â° N");zone="";ew="";nw="";return}lw=parseFloat(lw);bw=parseFloat(bw);a=6378137;f=0.00335281068;pi=Math.PI;b_sel="CDEFGHJKLMNPQRSTUVWXX";c=a/(1-f);ex2=(2*f-f*f)/((1-f)*(1-f));ex4=ex2*ex2;ex6=ex4*ex2;ex8=ex4*ex4;e0=c*(pi/180)*(1-3*ex2/4+45*ex4/64-175*ex6/256+11025*ex8/16384);e2=c*(-3*ex2/8+15*ex4/32-525*ex6/1024+2205*ex8/4096);e4=c*(15*ex4/256-105*ex6/1024+2205*ex8/16384);e6=c*(-35*ex6/3072+315*ex8/12288);lzn=parseInt((lw+180)/6)+1;lz=lzn;if(lzn<10){lz="0"+lzn}bd=parseInt(1+(bw+80)/8);bz=b_sel.substr(bd-1,1);br=bw*pi/180;tan1=Math.tan(br);tan2=tan1*tan1;tan4=tan2*tan2;cos1=Math.cos(br);cos2=cos1*cos1;cos4=cos2*cos2;cos3=cos2*cos1;cos5=cos4*cos1;etasq=ex2*cos2;nd=c/Math.sqrt(1+etasq);g=(e0*bw)+(e2*Math.sin(2*br))+(e4*Math.sin(4*br))+(e6*Math.sin(6*br));lh=(lzn-30)*6-3;dl=(lw-lh)*pi/180;dl2=dl*dl;dl4=dl2*dl2;dl3=dl2*dl;dl5=dl4*dl;if(bw<0){nw=10000000+0.9996*(g+nd*cos2*tan1*dl2/2+nd*cos4*tan1*(5-tan2+9*etasq)*dl4/24)}else{nw=0.9996*(g+nd*cos2*tan1*dl2/2+nd*cos4*tan1*(5-tan2+9*etasq)*dl4/24)}ew=0.9996*(nd*cos1*dl+nd*cos3*(1-tan2+etasq)*dl3/6+nd*cos5*(5-18*tan2+tan4)*dl5/120)+500000;zone=lz+bz;nk=nw-parseInt(nw);if(nk<0.5){nw=""+parseInt(nw)}else{nw=""+(parseInt(nw)+1)}while(nw.length<7){nw="0"+nw}nk=ew-parseInt(ew);if(nk<0.5){ew="0"+parseInt(ew)}else{ew="0"+parseInt(ew+1)}return{zone:zone,x:ew,y:nw}},_utm2mgr:function(b){zone=b.zone;ew=b.x;nw=b.y;z1=zone.substr(0,2);z2=zone.substr(2,1);ew1=parseInt(ew.substr(0,2));nw1=parseInt(nw.substr(0,2));ew2=ew.substr(2,5);nw2=nw.substr(2,5);m_east="ABCDEFGHJKLMNPQRSTUVWXYZ";m_north="ABCDEFGHJKLMNPQRSTUV";if(z1<"01"||z1>"60"||z2<"C"||z2>"X"){alert(z1+z2+" ist keine gültige UTM Zonenangabe")}i=z1%3;if(i===1){m_ce=ew1-1}if(i===2){m_ce=ew1+7}if(i===0){m_ce=ew1+15}i=z1%2;if(i===1){m_cn=0}else{m_cn=5}i=nw1;while(i-20>=0){i=i-20}m_cn=m_cn+i;if(m_cn>19){m_cn=m_cn-20}band=m_east.charAt(m_ce)+m_north.charAt(m_cn);return{zone:zone,band:band,x:ew2,y:nw2}},_mgr2utm:function(b){m_east_0="STUVWXYZ";m_east_1="ABCDEFGH";m_east_2="JKLMNPQR";m_north_0="FGHJKLMNPQRSTUVABCDE";m_north_1="ABCDEFGHJKLMNPQRSTUV";zone=b.zone;r_east=b.band.substr(0,1);r_north=b.band.substr(1,1);i=parseInt(zone.substr(0,2))%3;if(i===0){m_ce=m_east_0.indexOf(r_east)+1}if(i===1){m_ce=m_east_1.indexOf(r_east)+1}if(i===2){m_ce=m_east_2.indexOf(r_east)+1}ew="0"+m_ce+ew2;i=parseInt(zone.substr(0,2))%2;if(i===0){m_cn=m_north_0.indexOf(r_north)}else{m_cn=m_north_1.indexOf(r_north)}band=zone.substr(2,1);if(band>="N"){if(band==="Q"&&m_cn<10){m_cn=m_cn+20}if(band>="R"){m_cn=m_cn+20}if(band==="S"&&m_cn<30){m_cn=m_cn+20}if(band>="T"){m_cn=m_cn+20}if(band==="U"&&m_cn<50){m_cn=m_cn+20}}else{if(band==="C"&&m_cn<10){m_cn=m_cn+20}if(band>="D"){m_cn=m_cn+20}if(band==="F"&&m_cn<30){m_cn=m_cn+20}if(band>="G"){m_cn=m_cn+20}if(band==="H"&&m_cn<50){m_cn=m_cn+20}if(band>="J"){m_cn=m_cn+20}if(band==="K"&&m_cn<70){m_cn=m_cn+20}if(band>="L"){m_cn=m_cn+20}}if(m_cn.length===1){nw="0"+m_cn+nw2}else{nw=""+m_cn+nw2}return{zone:zone,x:ew,y:nw}},_geo2geodeziminuten:function(b){latgrad=parseInt(b.lat);latminuten=Math.round(((b.lat-latgrad)*60)*10000)/10000;lnggrad=parseInt(b.lng);lngminuten=Math.round(((b.lng-lnggrad)*60)*10000)/10000;return this._AddNSEW({latgrad:latgrad,latminuten:latminuten,lnggrad:lnggrad,lngminuten:lngminuten})},_geo2gradminutensekunden:function(b){latgrad=parseInt(b.lat);latminuten=(b.lat-latgrad)*60;latsekunden=Math.round(((latminuten-parseInt(latminuten))*60)*100)/100;latminuten=parseInt(latminuten);lnggrad=parseInt(b.lng);lngminuten=(b.lng-lnggrad)*60;lngsekunden=Math.round(((lngminuten-parseInt(lngminuten))*60)*100)/100;lngminuten=parseInt(lngminuten);return this._AddNSEW({latgrad:latgrad,latminuten:latminuten,latsekunden:latsekunden,lnggrad:lnggrad,lngminuten:lngminuten,lngsekunden:lngsekunden})},_AddNSEW:function(b){b.NS="N";b.WE="E";if(b.latgrad<0){b.latgrad=b.latgrad*(-1);b.NS="S"}if(b.lnggrad<0){b.lnggrad=b.lnggrad*(-1);b.EW="W"}return b}});L.control.mouseCoordinate=function(b){return new L.Control.mouseCoordinate(b)};